# 云主机同步功能设置指南

## 功能概述

云主机同步功能允许您从云厂商（阿里云、腾讯云、AWS等）自动同步主机信息到系统中，避免手动添加主机的繁琐操作。

## 支持的云厂商

- ✅ **阿里云** (Alibaba Cloud)
- ✅ **腾讯云** (Tencent Cloud)  
- 🚧 **AWS** (Amazon Web Services) - 开发中

## 安装依赖

### 阿里云同步

```bash
# 安装阿里云ECS SDK
pip install alibabacloud_ecs20140526
```

### 腾讯云同步

```bash
# 安装腾讯云SDK
pip install tencentcloud-sdk-python
```

### AWS同步（开发中）

```bash
# 安装AWS SDK
pip install boto3
```

## 配置云厂商凭证

### 1. 进入系统配置

访问系统管理 -> 系统配置，找到"云厂商配置"分类。

### 2. 配置阿里云

- **cloud.aliyun.access_key**: 阿里云AccessKey ID
- **cloud.aliyun.secret_key**: 阿里云AccessKey Secret
- **cloud.aliyun.region**: 默认地域（如：cn-hangzhou）

### 3. 配置腾讯云

- **cloud.tencent.secret_id**: 腾讯云SecretId
- **cloud.tencent.secret_key**: 腾讯云SecretKey
- **cloud.tencent.region**: 默认地域（如：ap-guangzhou）

### 4. 配置AWS（开发中）

- **cloud.aws.access_key**: AWS Access Key ID
- **cloud.aws.secret_key**: AWS Secret Access Key
- **cloud.aws.region**: 默认地域（如：us-east-1）

## 获取云厂商凭证

### 阿里云

1. 登录阿里云控制台
2. 访问 RAM 访问控制 -> 用户
3. 创建用户并授予ECS相关权限
4. 创建AccessKey

### 腾讯云

1. 登录腾讯云控制台
2. 访问 访问管理 -> 用户 -> 用户列表
3. 创建用户并授予CVM相关权限
4. 创建API密钥

## 使用云同步功能

### 1. 在主机管理页面

1. 进入主机管理页面
2. 点击"云同步"下拉按钮
3. 选择要同步的云厂商
4. 等待同步完成

### 2. 同步结果

- 系统会自动检测云主机信息
- 新主机会被添加到系统中
- 已存在的主机会更新信息
- 同步完成后会显示统计信息

### 3. 云厂商过滤

- 在主机列表的搜索筛选中
- 可以按云厂商类型过滤主机
- 支持所有已配置的云厂商

## 同步的信息

系统会自动同步以下信息：

- **基本信息**: 主机名称、实例ID
- **网络信息**: 内网IP、公网IP、MAC地址
- **系统信息**: 操作系统类型、版本
- **硬件信息**: CPU核心数、内存大小
- **云厂商信息**: 地域、可用区、实例类型
- **状态信息**: 运行状态

## 注意事项

1. **权限要求**: 确保云厂商凭证有足够的权限读取ECS/CVM实例信息
2. **网络连接**: 服务器需要能够访问云厂商的API接口
3. **凭证安全**: 云厂商凭证会加密存储，请妥善保管
4. **同步频率**: 建议定期手动同步，避免频繁调用API
5. **费用考虑**: API调用可能产生少量费用，请查看云厂商计费说明

## 故障排除

### 同步失败

1. 检查云厂商凭证是否正确
2. 检查网络连接是否正常
3. 检查云厂商API权限是否足够
4. 查看系统日志获取详细错误信息

### SDK安装问题

1. 确保Python环境正确
2. 使用正确的包管理器安装SDK
3. 检查依赖包版本兼容性

### 权限问题

1. 确保云厂商用户有ECS/CVM读取权限
2. 检查访问控制策略配置
3. 验证API密钥是否激活

## 开发计划

- [ ] 支持更多云厂商（华为云、百度云等）
- [ ] 定时自动同步功能
- [ ] 增量同步优化
- [ ] 同步历史记录
- [ ] 批量操作优化
